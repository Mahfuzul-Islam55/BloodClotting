/*
vendor_id,datetime_id,
       'passenger_count', 'trip_id', 'rate_id', 
	'store_and_fwd_flag', 'location_id','payment_type_id',
	 'fare_amount', 'extra', 'mta_tax', 
	'tip_amount', 'tolls_amount', 'improvement_surcharge',
       'total_amount', 'congestion_surcharge', 'airport_fee',
	'speed_id
*/



--fact table

INSERT INTO dbo.fact_table (vendor_id,datetime_id,passenger_count
		,trip_id, rate_id, store_and_fwd_flag,
       location_id,payment_type_id,fare_amount,
	   extra, mta_tax, tip_amount,
	   tolls_amount, improvement_surcharge, total_amount,
	   congestion_surcharge, airport_fee, speed_id)
SELECT 
VE.id AS vendor_id,
DT.id AS datetime_id,
MAIN.passenger_count,
TRIP.id AS trip_id,
RATE.id AS rate_id,
MAIN.store_and_fwd_flag,
LOC.id AS location_id,
PT.id AS payment_type_id,

MAIN.fare_amount,
MAIN.extra,
MAIN.mta_tax,
MAIN.tip_amount,
MAIN.tolls_amount,
MAIN.improvement_surcharge,
MAIN.total_amount,
MAIN.congestion_surcharge,
MAIN.airport_fee,
speed.id as speed_id

FROM dbo.table_main AS MAIN
LEFT JOIN dbo.Dim_datetime AS DT
ON DT.tpep_pickup_datetime = MAIN.tpep_pickup_datetime
AND DT.tpep_dropoff_datetime = MAIN.tpep_dropoff_datetime

LEFT JOIN dbo.Dim_Vendor AS VE
ON MAIN.VendorID = VE.vendor_code

LEFT JOIN dbo.Dim_Rate_ID AS RATE
ON RATE.rate_code = MAIN.RatecodeID

LEFT JOIN dbo.Dim_Payment_Type AS PT
ON PT.payment_type_code = MAIN.payment_type

LEFT JOIN DBO.Dim_trips AS TRIP
ON TRIP.pick_up_location_id = MAIN.PULocationID 
AND TRIP.dropoff_location_id = MAIN.DOLocationID

/*
LEFT JOIN dbo.Dim_location AS LOC
ON LOC.location_id = MAIN.PULocationID
OR LOC.location_id = MAIN.DOLocationID */

LEFT JOIN dbo.Dim_speed as speed
ON MAIN.id = speed.id







SELECT 
PT.id AS PAYMENT_ID,
DT.id AS DATETIME_ID,
RATE.id AS RATE_ID,
VE.id AS VENDOR_ID,
TRIP.id AS TRIP_ID,
LOC.id AS LOCATION_ID,
MAIN.fare_amount,
MAIN.extra,
MAIN.mta_tax,
MAIN.tip_amount,
MAIN.tolls_amount,
MAIN.improvement_surcharge,
MAIN.total_amount,
MAIN.congestion_surcharge,
MAIN.airport_fee,
MAIN.store_and_fwd_flag

FROM dbo.table_main AS MAIN
LEFT JOIN dbo.Dim_datetime AS DT
ON DT.tpep_pickup_datetime = MAIN.tpep_pickup_datetime
AND DT.tpep_dropoff_datetime = MAIN.tpep_dropoff_datetime
LEFT JOIN dbo.Dim_Vendor AS VE
ON MAIN.VendorID = VE.vendor_code
LEFT JOIN dbo.Dim_Rate_ID AS RATE
ON RATE.rate_code = MAIN.RatecodeID
LEFT JOIN dbo.Dim_Payment_Type AS PT
ON PT.payment_type_code = MAIN.payment_type
LEFT JOIN DBO.Dim_trips AS TRIP
ON TRIP.pick_up_location_id = MAIN.PULocationID 
AND TRIP.dropoff_location_id = MAIN.DOLocationID
LEFT JOIN dbo.Dim_location AS LOC
ON LOC.location_id = MAIN.PULocationID
OR LOC.location_id = MAIN.DOLocationID



32 52 717 initial
33 06 007 datetime_id
32 52 717 vendor id
		rate id
		payment id
trip
location
speed




VE.id AS vendor_id,
DT.id AS datetime_id,
MAIN.passenger_count,
TRIP.id AS trip_id,
RATE.id AS rate_id,
MAIN.store_and_fwd_flag,

PT.id AS payment_type_id,

MAIN.fare_amount,
MAIN.extra,
MAIN.mta_tax,
MAIN.tip_amount,
MAIN.tolls_amount,
MAIN.improvement_surcharge,
MAIN.total_amount,
MAIN.congestion_surcharge,
MAIN.airport_fee,
speed.id as Speed_id




long trip which vendor


